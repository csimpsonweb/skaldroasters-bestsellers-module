<?php
/** @var \WildDonkey\Bestsellers\Block\HomeBestsellers $block */
$sections = $block->getSections();
?>

<?php if (!$sections): ?>
    <div class="container mx-auto px-4 my-10 text-sm opacity-70">No bestsellers to display.</div>
    <?php return; ?>
<?php endif; ?>

<div class="container mx-auto px-4 my-10 space-y-10">
    <?php foreach ($sections as $section): ?>
        <?php
        /** @var \Magento\Catalog\Model\ResourceModel\Product\Collection $products */
        $products = $section['collection'];
        $title    = (string)$section['title'];
        ?>
        <section>
            <?php if ($title): ?>
                <h2 class="text-2xl font-semibold mb-4"><?= $block->escapeHtml($title) ?></h2>
            <?php endif; ?>

            <?php if (!$products->getSize()): ?>
                <p class="text-sm opacity-70">No bestsellers found in this category yet.</p>
            <?php else: ?>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-6">
                    <?php foreach ($products as $_product): ?>
                        <article class="group rounded-2xl border border-gray-200 p-4 bg-white shadow-sm">
                            <a class="block" href="<?= $block->escapeUrl($_product->getProductUrl()) ?>">
                                <?= $block->getImage($_product, 'category_page_grid')->toHtml(); ?>
                                <h3 class="mt-3 text-sm font-medium leading-tight line-clamp-2">
                                    <?= $block->escapeHtml($_product->getName()) ?>
                                </h3>
                                <div class="mt-1">
                                    <?= $block->getProductPrice($_product); ?>
                                </div>
                            </a>

                            <div class="mt-3">
                                <?php if ($_product->isSaleable() && $_product->getTypeId() === \Magento\Catalog\Model\Product\Type::TYPE_SIMPLE): ?>
                                    <form method="post" action="<?= $block->escapeUrl($block->getAddToCartUrl($_product)) ?>" class="w-full">
                                        <?= $block->getBlockHtml('formkey') ?>
                                        <input type="hidden" name="product" value="<?= (int)$_product->getId() ?>">
                                        <button type="submit"
                                                class="w-full rounded-lg px-4 py-2 bg-primary text-white hover:opacity-90 transition">
                                            Add to cart
                                        </button>
                                    </form>
                                <?php else: ?>
                                    <a href="<?= $block->escapeUrl($_product->getProductUrl()) ?>"
                                       class="w-full inline-block text-center rounded-lg px-4 py-2 border border-gray-300 hover:bg-gray-50 transition">
                                        View options
                                    </a>
                                <?php endif; ?>
                            </div>
                        </article>
                    <?php endforeach; ?>
                </div>
            <?php endif; ?>
        </section>
    <?php endforeach; ?>
</div>
